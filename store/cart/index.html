<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart2</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --main-color: rgba(247, 221, 201, 0.905);
            --main-color-hover: rgba(203, 184, 170, 0.905);
            --font-family: 'Encode Sans Expanded', sans-serif;
        }


        table {
            background-color: var(--main-color);
        }

        table i:hover {
            color: var(--main-color-hover);
        }

        nav i {
            color: black;
        }

        .img {
            width: 10rem;
            height: 8rem;
        }

        .imgemp {
            width: 60vw;
            height: 60vh;
        }
        .container {
            overflow: hidden;
            text-align: justify;
            border-radius: 10%;
        }

        .second {
            float: right;
        }
        
    </style>
    <script>
        addEventListener('load', function () {

            let products1 = [];
            userData1 = {
                id: "2",
                name: "kareem",
                email: "kareem@gmail.com",
                role: "user",
            };
            usersList = [
                {
                    id: "1",
                    name: "test",
                    email: "test@gmail.com",
                    password: "123456",
                    role: "user", // user,seller
                },
            ];
            cartList = [
                {
                    id: "1", // id of the cart item
                    cartOwner: "1", // id of user
                    totalCartPrice: 0, // 30742 EGP
                    products: [],
                },
                //start of object = (user card)
                {
                    id: "2", // id of the cart item = (ProductID)
                    cartOwner: "2", // id of user
                    totalCartPrice: 300, // 300 EGP
                    products: [
                        //start of cap1
                        {
                            count: 1,
                            product: {
                                id: "1",
                                images: ["pic/198982_1665262072.webp", "pic/198982_1665262072.webp", "pic/198982_1665262072.webp", "pic/198982_1665262072.webp"],
                                name: "cap",
                                description: "test description test description test description",
                                price: 50, // 200 EGP
                                discount: 10, // 10%
                                quantity: 10,
                                category: {
                                    id: "6439d2d167d9aa4ca970649f",
                                    name: "Electronics",
                                },
                                seller: {
                                    id: "1",
                                    name: "km store",
                                },
                                rating: 4.8,
                            },
                            totalPrice: 50, // product price (200) * count (2) = 400
                        },
                        // start of cap2
                        {
                            count: 1,
                            product: {
                                id: "2",
                                images: ["pic/free-latest-ny-baseball-cap-highever-original-imagnm8yxxvmhmdy.webp", "pic/free-latest-ny-baseball-cap-highever-original-imagnm8yxxvmhmdy.webp", "pic/free-latest-ny-baseball-cap-highever-original-imagnm8yxxvmhmdy.webp", "pic/free-latest-ny-baseball-cap-highever-original-imagnm8yxxvmhmdy.webp"],
                                name: "cap2",
                                description: "test description test description test description",
                                price: 100, // 200 EGP
                                discount: 10, // 10%
                                quantity: 25,
                                category: {
                                    id: "6439d2d167d9aa4ca970649f",
                                    name: "Electronics",
                                },
                                seller: {
                                    id: "1",
                                    name: "km store",
                                },
                                rating: 4.8,
                            },
                            totalPrice: 100, // product price (200) * count (2) = 400
                        },
                        // start of cap3
                        {
                            count: 1,
                            product: {
                                id: "3",
                                images: ["pic/hats-caps-printing.jpg", "pic/hats-caps-printing.jpg", "pic/hats-caps-printing.jpg", "pic/hats-caps-printing.jpg"],
                                name: "cap3",
                                description: "test description test description test description",
                                price: 150, // 200 EGP
                                discount: 10, // 10%
                                quantity: 20,
                                category: {
                                    id: "6439d2d167d9aa4ca970649f",
                                    name: "Electronics",
                                },
                                seller: {
                                    id: "1",
                                    name: "km store",
                                },
                                rating: 4.8,
                            },
                            totalPrice: 150, // product price (200) * count (2) = 400
                        },
                    ],
                },
                //end of user card
            ];
            localStorage.setItem("usersList",JSON.stringify(usersList));
            localStorage.setItem("cartList", JSON.stringify(cartList));
            localStorage.setItem("userData", JSON.stringify(userData1));
            var userData = JSON.parse(localStorage.getItem("userData"));

            // document.addEventListener("DOMContentLoaded", () => {
                usersList = JSON.parse(localStorage.getItem("usersList")) || [];
                if (!userData ) {
                    let section = document.getElementsByTagName("section")[1];
                section.style.display = "none";
                let section1 = document.getElementById("sec1");
                section1.style.display = "block";
                alert("Auth error");
                    localStorage.removeItem("userData");
                    return;
                }
            // });

            userCard = cartList.find((el) => el.cartOwner == userData.id);
            if (!userCard) {
                console.error("User not found");
                let section = document.getElementsByTagName("section")[1];
                section.style.display = "none";
                let section1 = document.getElementById("sec1");
                section1.style.display = "block";

            } else {
                
                userCard.products.map(ele => {
                    obj = {
                        id: 0,
                        img: "",
                        name: "",
                        price: 0
                    };
                    obj.id = ele.product.id;
                    obj.img = ele.product.images[0];
                    obj.name = ele.product.name;
                    obj.price = ele.product.price;
                    products1.push(obj);
                });
                if (products1.length != 0) {
                    localStorage.setItem("products", JSON.stringify(products1));
                    productsstring = localStorage.getItem("products");
                    products = JSON.parse(productsstring);



                    
                    gettotal = document.getElementById("total");
                    // getshipping = document.getElementById("shipping");
                    x = 1;
                    price = 0;
                    allprice = 0;
                    witninc = 0;
                    tbody = document.getElementsByTagName("tbody")[0];
                    creat_tdimg = document.createElement("td");
                    products.forEach(obj => {
                        var creat_tr = document.createElement("tr");
                        let values = Object.values(obj);
                        for (let i = 0; i < values.length; i++) {
                            if (i == 0) {
                                creat_th = document.createElement("th");
                                creat_th.setAttribute("scope", "row");
                                creat_th.innerHTML = `${values[i]}`;
                                creat_tr.appendChild(creat_th);
                            } else if (i == 1) {
                                var creatimg = document.createElement('img');
                                creatimg.src = values[i];
                                creatimg.className = "img";
                                creattdimg = document.createElement("td");
                                creattdimg.appendChild(creatimg);
                                creat_tr.appendChild(creattdimg);
                            } else {
                                creattd = document.createElement("td");
                                creattd.innerHTML = `${values[i]}`;
                                creat_tr.appendChild(creattd);
                            }
                        }
                        creat_tddelet = document.createElement("td");
                        var creat_tdnum = document.createElement("td");
                        var createdinc = document.createElement("i")
                        createdinc.setAttribute("class", "fa-solid fa-plus");
                        var num = document.createElement("span");
                        num.setAttribute("class", "m-2");
                        num.innerHTML = `${x}`;
                        var createddec = document.createElement("i")
                        createddec.setAttribute("class", "fa-solid fa-minus");
                        creat_tdnum.appendChild(createdinc);
                        creat_tdnum.appendChild(num);
                        creat_tdnum.appendChild(createddec);

                        var del = document.createElement("i");
                        del.setAttribute("class", "fa-solid fa-x")
                        creat_tddelet.appendChild(del);

                        creat_tr.appendChild(creat_tdnum);
                        creat_tr.appendChild(creat_tddelet)
                        tbody.appendChild(creat_tr);

                        createdinc.addEventListener("click", function () {
                            incnum = this.nextSibling.innerHTML;
                            userCard.products.map(ele => {
                                if (ele.product.id == this.parentElement.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.innerHTML) {
                                    qu = ele.product.quantity;
                                }
                            });
                            if (incnum >= qu) {
                                num.innerHTML = `${qu}`;
                            } else {
                                inc = parseInt(incnum) + 1
                                num.innerHTML = `${inc}`;
                            }

                            incprice = parseInt(this.parentElement.previousSibling.innerHTML);
                            price = incprice + incprice;
                            allprice -= incprice;
                            allprice += price;
                            
                            total = allprice;
                            gettotal.value = `${total}EGP`;
                            cartlist = JSON.parse(localStorage.getItem("cartList"));
                            userCard.products.map(elem => {
                                if (elem.product.id == this.parentElement.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.innerHTML) {
                                    elem.count = parseInt(num.innerHTML);
                                    elem.totalPrice = elem.product.price * elem.count;
                                }
                            });
                            userCard.totalCartPrice = allprice;
                            cartList[parseInt(userCard.id) - 1] = userCard;
                            localStorage.removeItem("cartList");
                            localStorage.setItem("cartList", JSON.stringify(cartList));
                        }); //end of +
                        createddec.addEventListener("click", function () {

                            decnum = this.previousSibling.innerHTML
                            dec = parseInt(decnum)

                            if (dec > 1) {
                                if (dec > 1) {
                                    dec--;
                                    // dec = 1;
                                    num.innerHTML = `${dec}`;
                                } else {
                                    num.innerHTML = "1";
                                }
                                decprice = parseInt(this.parentElement.previousSibling.innerHTML);
                                allprice -= decprice;

                            
                                total = allprice;
                                gettotal.value = `${total}EGP`;

                                cartlist = JSON.parse(localStorage.getItem("cartList"));
                                userCard.products.map(elem => {
                                    if (elem.product.id == this.parentElement.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.innerHTML) {
                                        elem.count = dec;

                                        elem.totalPrice = elem.product.price * elem.count;
                                    }
                                });
                                userCard.totalCartPrice = allprice;
                                cartList[parseInt(userCard.id) - 1] = userCard;
                                localStorage.removeItem("cartList");
                                localStorage.setItem("cartList", JSON.stringify(cartList));
                            }



                        }) //end of -
                        del.addEventListener("click", function () {
                            var vali = confirm("are you sure??");
                            if (vali) {
                                var td = this.parentElement
                                td.parentElement.remove();
                                iddel = parseInt(this.parentElement.previousSibling.previousSibling.previousSibling.previousSibling.previousSibling.innerHTML);


                                deletedprice = parseInt(this.parentElement.previousSibling.previousSibling.innerHTML);
                                updatedprice = deletedprice * parseInt(num.innerHTML);
                                allprice -= updatedprice;
                                
                                total = allprice;
                                gettotal.value = `${total}EGP`;

                                cartlist = JSON.parse(localStorage.getItem("cartList"));
                                userCard.products.map(elem => {
                                    if (elem.product.id == iddel) {
                                        userCard.products.splice(products.findIndex(i => i.id == iddel), 1);
                                    }
                                });
                                products.splice(products.findIndex(a => a.id == iddel), 1);
                                localStorage.removeItem("products");
                                localStorage.setItem("products", JSON.stringify(products));
                                userCard.totalCartPrice = allprice;
                                cartList[parseInt(userCard.id) - 1] = userCard;
                                localStorage.removeItem("cartList");
                                localStorage.setItem("cartList", JSON.stringify(cartList));
                            }; // end of condition
                            if (products.length == 0) {
                                let section = document.getElementsByTagName("section")[1];
                                section.style.display = "none";
                                let section1 = document.getElementById("sec1");
                                section1.style.display = "block";
                            }
                        }); //end of delet
                    }); // end of build table

                    for (let i = 0; i < products.length; i++) {
                        val = Object.values(products[i]);
                        witninc = val[3];
                        allprice += witninc;

                    };
                    

                    // shippingval = parseInt(getshipping.value);
                    total = allprice;
                    gettotal.value = `${total}EGP`;
                    cartlist = JSON.parse(localStorage.getItem("cartList"));
                    userCard.totalCartPrice = allprice;
                    cartList[parseInt(userCard.id) - 1] = userCard;
                    localStorage.removeItem("cartList");
                    localStorage.setItem("cartList", JSON.stringify(cartList));
                    
                } else {
                    let section = document.getElementsByTagName("section")[1];
                    section.style.display = "none";
                    let section1 = document.getElementById("sec1");
                    section1.style.display = "block";
                }; //end of validate length of Products in cart
                // var products1 = [{
                //     id: 1,
                //     img: "pic/198982_1665262072.webp",
                //     name: "cap",
                //     price: 50
                // }, {
                //     id: 2,
                //     img: "pic/free-latest-ny-baseball-cap-highever-original-imagnm8yxxvmhmdy.webp",
                //     name: "cap2",
                //     price: 100
                // }, {
                //     id: 3,
                //     img: "pic/hats-caps-printing.jpg",
                //     name: "cap3",
                //     price: 150
                // }];
            }; //end of validate user id
            
        }); //end of load
    </script>
</head>

<body>
    <!-- <nav class="navbar navbar-expand-md navbar-light bg-light fixed-top ">
        <div class="container">
            <a class="navbar-brand" href="#">Click shop</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Category</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">about</a>
                    </li>

                </ul>
            </div>
        </div>
    </nav> -->
    <section id="sec1" style="display: none; text-align: center;">

        <img src="pic/empty.png" alt="">
        <h3 class="text-secondary">Your cart is empty</h3>
        <p class="text-secondary">looks like you haven't made your choice yet...</p>
        <a href="#" class="btn btn-success text-white">go shopping</a>
    </section>


    <section class="container-fluid text-center">
        <div class="row">
            <div class="col-sm-8 col-12 table-responsive" style="margin-top: 5rem ;">
                <table class="table" style="width: 60vw;">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th scope="col">Products</th>
                            <th scope="col">Description</th>
                            <th scope="col">price</th>
                            <th scope="col">Quantity</th>
                            <th scope="col">delet</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div> <!--your cart-->

            

                <div class="card col-sm-4 col-12" style="margin-top: 5rem ;">
                    <div style="background-color: var(--main-color-hover); text-align: center; font-size: 2rem;">
                        The total price
                    </div>
                    <div class="card-body text-center">
                        <h5 class="card-title ">Products :</h5>
                            
                                <img src="pic/free-product-135-781070.webp" style="width: 22vw;height: 20vh;">
                            
                    </div>
                    
                    <h2 style="background-color:var(--main-color); width:10rem ;margin: 0 auto;text-align: center;">
                        Total :<div class="input-group">
                            <input type="text" class="form-control text-center" id="total" disabled
                                aria-label="Dollar amount (with dot and two decimal places)">
                        </div>
                    </h2>
                    <div class="card-footer mt-2" style="text-align: center;">
                        <a href="checkout.html" class="btn btn-dark fs-3">Checkout</a>
                    </div>
                </div>
            
        </div> <!--check out-->
        </div>
    </section>
    <script src="Js/bootstrap.bundle.js"></script>
</body>

</html>